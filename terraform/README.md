# assignment terraform

## Table of Contents
* [Requirements](##requirements)
* [Setup](##setup)
* [Usage](##usage)
* [References](##references)
* [Memos](##memos)

## Requirements
- Mac OS
- Terraform CLI 0.14.3

## Setup
### Install terraform CLI

Install tfenv
```
brew install tfenv
```

Install terraform cli
```
tfenv install 0.14.3
tfenv use 0.14.3
```


### Set AWS Credentials
Set your aws credentails to the environment.
```
export AWS_ACCESS_KEY_ID=${YOUR_ACCESS_KEY_ID}
export AWS_SECRET_ACCESS_KEY=${YOUR_SECRET_ACCESS_KEY}
export AWS_DEFAULT_REGION=ap-northeast-1
```

### Set Github personal access token
You need to set master key of rails project and database password like below. If you don't could not access, please ask someone.
```
export TF_VAR_rails_master_key=YOUR RAILS MASTER KEY
export TF_VAR_database_password=YOUR DATABASE PASSWORD
```

### Create S3 bucket to store tfstate
To store tfstate at S3, we need to create S3 bucket.
Please create S3 named "assignment-terraform-state" and be careful not to make it public.

### Confirm tfvars
Some variables are set at "terraform.tfvars" and it needs to be checked before running terraform.


## Usage

Install dependencies
```
terraform init
```

Create an execution plan
```
terraform plan
```

Apply pre-determined set of actions generated by the ` terraform plan `
```
terraform apply
```

## Styling

Run linter
```
terraform fmt -recursive
```

Validate whether the configuration is valid
```
terraform validate
```

## References
- [IP architecture](https://www.notion.so/iruuzainc/IP-architecture-85d035693086447c88fcf286f682d21b). This document is for iCode, but assignment also follows it.


## Memos
- We aren't managing DNS on terraform currently.
- We're not using workspace feature for switching environment (staging / production), because it's for testing according to [the official document](https://www.terraform.io/docs/state/workspaces.html#when-to-use-multiple-workspaces).
- See [the official best practices](https://www.terraform-best-practices.com/) to keep this project clean and simple.